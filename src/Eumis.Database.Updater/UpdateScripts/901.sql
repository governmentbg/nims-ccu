GO
--fix default permissions
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'OperationalMapAdminPermissions,CanAdministrate; SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl;RegistrationPermissions,CanRead;ContractRegistrationPermissions,CanRead;ActionLogPermissions,CanRead;SapInterfacePermissions,CanImport;InterfacesPermissions,CanExport|1,OperationalMapPermissions,CanRead;1,OperationalMapPermissions,CanWrite;1,ProcedurePermissions,CanRead;1,ProcedurePermissions,CanWrite;1,ProcedurePermissions,CanCheck;1,ProcedurePermissions,CanDelete;1,ProjectPermissions,CanRead;1,ProjectPermissions,CanRegister;1,ContractPermissions,CanRead;1,ProjectPermissions,CanWithdraw;1,ContractPermissions,CanWrite;1,ContractPermissions,CanCheck;1,ContractCommunicationPermissions,CanRead;1,ContractCommunicationPermissions,CanWrite;1,ContractCommunicationPermissions,CanWrite;1,IndicatorPermissions,CanRead;1,IndicatorPermissions,CanWrite;2,OperationalMapPermissions,CanRead;2,OperationalMapPermissions,CanWrite;2,ProcedurePermissions,CanRead;2,ProcedurePermissions,CanWrite;2,ProcedurePermissions,CanCheck;2,ProcedurePermissions,CanDelete;2,ProjectPermissions,CanRead;2,ProjectPermissions,CanRegister;2,ProjectPermissions,CanWithdraw;2,ContractPermissions,CanRead;2,ContractPermissions,CanWrite;2,ContractPermissions,CanCheck;2,ContractCommunicationPermissions,CanRead;2,ContractCommunicationPermissions,CanWrite;2,ContractCommunicationPermissions,CanWrite;2,IndicatorPermissions,CanRead;2,IndicatorPermissions,CanWrite;3,OperationalMapPermissions,CanRead;3,OperationalMapPermissions,CanWrite;3,ProcedurePermissions,CanRead;3,ProcedurePermissions,CanWrite;3,ProcedurePermissions,CanCheck;3,ProcedurePermissions,CanDelete;3,ProjectPermissions,CanRead;3,ProjectPermissions,CanRegister;3,ProjectPermissions,CanWithdraw;3,ContractPermissions,CanRead;3,ContractPermissions,CanWrite;3,ContractPermissions,CanCheck;3,ContractCommunicationPermissions,CanRead;3,ContractCommunicationPermissions,CanWrite;3,ContractCommunicationPermissions,CanWrite;3,IndicatorPermissions,CanRead;3,IndicatorPermissions,CanWrite;4,OperationalMapPermissions,CanRead;4,OperationalMapPermissions,CanWrite;4,ProcedurePermissions,CanRead;4,ProcedurePermissions,CanWrite;4,ProcedurePermissions,CanCheck;4,ProcedurePermissions,CanDelete;4,ProjectPermissions,CanRead;4,ProjectPermissions,CanRegister;4,ProjectPermissions,CanWithdraw;4,ContractPermissions,CanRead;4,ContractPermissions,CanWrite;4,ContractPermissions,CanCheck;4,ContractCommunicationPermissions,CanRead;4,ContractCommunicationPermissions,CanWrite;4,ContractCommunicationPermissions,CanWrite;4,IndicatorPermissions,CanRead;4,IndicatorPermissions,CanWrite;5,OperationalMapPermissions,CanRead;5,OperationalMapPermissions,CanWrite;5,ProcedurePermissions,CanRead;5,ProcedurePermissions,CanWrite;5,ProcedurePermissions,CanCheck;5,ProcedurePermissions,CanDelete;5,ProjectPermissions,CanRead;5,ProjectPermissions,CanRegister;5,ProjectPermissions,CanWithdraw;5,ContractPermissions,CanRead;5,ContractPermissions,CanWrite;5,ContractPermissions,CanCheck;5,ContractCommunicationPermissions,CanRead;5,ContractCommunicationPermissions,CanWrite;5,ContractCommunicationPermissions,CanWrite;5,IndicatorPermissions,CanRead;5,IndicatorPermissions,CanWrite;6,OperationalMapPermissions,CanRead;6,OperationalMapPermissions,CanWrite;6,ProcedurePermissions,CanRead;6,ProcedurePermissions,CanWrite;6,ProcedurePermissions,CanCheck;6,ProcedurePermissions,CanDelete;6,ProjectPermissions,CanRead;6,ProjectPermissions,CanRegister;6,ProjectPermissions,CanWithdraw;6,ContractPermissions,CanRead;6,ContractPermissions,CanWrite;6,ContractPermissions,CanCheck;6,ContractCommunicationPermissions,CanRead;6,ContractCommunicationPermissions,CanWrite;6,ContractCommunicationPermissions,CanWrite;6,IndicatorPermissions,CanRead;6,IndicatorPermissions,CanWrite;7,OperationalMapPermissions,CanRead;7,OperationalMapPermissions,CanWrite;7,ProcedurePermissions,CanRead;7,ProcedurePermissions,CanWrite;7,ProcedurePermissions,CanCheck;7,ProcedurePermissions,CanDelete;7,ProjectPermissions,CanRead;7,ProjectPermissions,CanRegister;7,ProjectPermissions,CanWithdraw;7,ContractPermissions,CanRead;7,ContractPermissions,CanWrite;7,ContractPermissions,CanCheck;7,ContractCommunicationPermissions,CanRead;7,ContractCommunicationPermissions,CanWrite;7,IndicatorPermissions,CanRead;7,IndicatorPermissions,CanWrite;1,ContractReportPermissions,CanRead;1,ContractReportPermissions,CanWrite;1,ContractReportPermissions,CanCheck;2,ContractReportPermissions,CanRead;2,ContractReportPermissions,CanWrite;2,ContractReportPermissions,CanCheck;3,ContractReportPermissions,CanRead;3,ContractReportPermissions,CanWrite;3,ContractReportPermissions,CanCheck;4,ContractReportPermissions,CanRead;4,ContractReportPermissions,CanWrite;4,ContractReportPermissions,CanCheck;5,ContractReportPermissions,CanRead;5,ContractReportPermissions,CanWrite;5,ContractReportPermissions,CanCheck;6,ContractReportPermissions,CanRead;6,ContractReportPermissions,CanWrite;6,ContractReportPermissions,CanCheck;7,ContractReportPermissions,CanRead;7,ContractReportPermissions,CanWrite;7,ContractReportPermissions,CanCheck;7,ContractCommunicationPermissions,CanWrite;1,MonitoringFinancialControlPermissions,CanRead;1,MonitoringFinancialControlPermissions,CanWriteFinancial;1,MonitoringFinancialControlPermissions,CanWriteTechnical;2,MonitoringFinancialControlPermissions,CanRead;2,MonitoringFinancialControlPermissions,CanWriteFinancial;2,MonitoringFinancialControlPermissions,CanWriteTechnical;3,MonitoringFinancialControlPermissions,CanRead;3,MonitoringFinancialControlPermissions,CanWriteFinancial;3,MonitoringFinancialControlPermissions,CanWriteTechnical;4,MonitoringFinancialControlPermissions,CanRead;4,MonitoringFinancialControlPermissions,CanWriteFinancial;4,MonitoringFinancialControlPermissions,CanWriteTechnical;5,MonitoringFinancialControlPermissions,CanRead;5,MonitoringFinancialControlPermissions,CanWriteFinancial;5,MonitoringFinancialControlPermissions,CanWriteTechnical;6,MonitoringFinancialControlPermissions,CanRead;6,MonitoringFinancialControlPermissions,CanWriteFinancial;6,MonitoringFinancialControlPermissions,CanWriteTechnical;7,MonitoringFinancialControlPermissions,CanRead;7,MonitoringFinancialControlPermissions,CanWriteFinancial;7,MonitoringFinancialControlPermissions,CanWriteTechnical;1,CertAuthorityCommunicationPermissions,CanRead;1,CertAuthorityCommunicationPermissions,CanWrite;2,CertAuthorityCommunicationPermissions,CanRead;2,CertAuthorityCommunicationPermissions,CanWrite;3,CertAuthorityCommunicationPermissions,CanRead;3,CertAuthorityCommunicationPermissions,CanWrite;4,CertAuthorityCommunicationPermissions,CanRead;4,CertAuthorityCommunicationPermissions,CanWrite;5,CertAuthorityCommunicationPermissions,CanRead;5,CertAuthorityCommunicationPermissions,CanWrite;6,CertAuthorityCommunicationPermissions,CanRead;6,CertAuthorityCommunicationPermissions,CanWrite,CanWrite;7,CertAuthorityCommunicationPermissions,CanRead;7,CertAuthorityCommunicationPermissions,CanWrite;1,ProjectDossierPermissions,CanRead;2,ProjectDossierPermissions,CanRead;3,ProjectDossierPermissions,CanRead;4,ProjectDossierPermissions,CanRead;5,ProjectDossierPermissions,CanRead;6,ProjectDossierPermissions,CanRead;7,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 1;
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl|1,OperationalMapPermissions,CanRead;1,OperationalMapPermissions,CanWrite;1,ProcedurePermissions,CanRead;1,ProcedurePermissions,CanWrite;1,ProcedurePermissions,CanCheck;1,ProcedurePermissions,CanDelete;1,ProjectPermissions,CanRead;1,ProjectPermissions,CanRegister;1,ContractPermissions,CanRead;1,ContractPermissions,CanWrite;1,ProjectPermissions,CanWithdraw;1,ContractPermissions,CanCheck;1,ContractCommunicationPermissions,CanRead;1,ContractCommunicationPermissions,CanWrite;1,ContractReportPermissions,CanRead;1,ContractReportPermissions,CanWrite;1,ContractReportPermissions,CanCheck;1,MonitoringFinancialControlPermissions,CanRead;1,MonitoringFinancialControlPermissions,CanWriteFinancial;1,MonitoringFinancialControlPermissions,CanWriteTechnical;1,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 2;
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl|2,OperationalMapPermissions,CanRead;2,OperationalMapPermissions,CanWrite;2,ProcedurePermissions,CanRead;2,ProcedurePermissions,CanWrite;2,ProcedurePermissions,CanCheck;2,ProcedurePermissions,CanDelete;2,ProjectPermissions,CanRead;2,ProjectPermissions,CanRegister;2,ContractPermissions,CanRead;2,ContractPermissions,CanWrite;2,ProjectPermissions,CanWithdraw;2,ContractPermissions,CanCheck;2,ContractCommunicationPermissions,CanRead;2,ContractCommunicationPermissions,CanWrite;2,ContractReportPermissions,CanRead;2,ContractReportPermissions,CanWrite;2,ContractReportPermissions,CanCheck;2,MonitoringFinancialControlPermissions,CanRead;2,MonitoringFinancialControlPermissions,CanWriteFinancial;2,MonitoringFinancialControlPermissions,CanWriteTechnical;2,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 3;
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl|3,OperationalMapPermissions,CanRead;3,OperationalMapPermissions,CanWrite;3,ProcedurePermissions,CanRead;3,ProcedurePermissions,CanWrite;3,ProcedurePermissions,CanCheck;3,ProcedurePermissions,CanDelete;3,ProjectPermissions,CanRead;3,ProjectPermissions,CanRegister;3,ContractPermissions,CanRead;3,ContractPermissions,CanWrite;3,ProjectPermissions,CanWithdraw;3,ContractPermissions,CanCheck;3,ContractCommunicationPermissions,CanRead;3,ContractCommunicationPermissions,CanWrite;3,ContractReportPermissions,CanRead;3,ContractReportPermissions,CanWrite;3,ContractReportPermissions,CanCheck;3,MonitoringFinancialControlPermissions,CanRead;3,MonitoringFinancialControlPermissions,CanWriteFinancial;3,MonitoringFinancialControlPermissions,CanWriteTechnical;3,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 4;
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl|4,OperationalMapPermissions,CanRead;4,OperationalMapPermissions,CanWrite;4,ProcedurePermissions,CanRead;4,ProcedurePermissions,CanWrite;4,ProcedurePermissions,CanCheck;4,ProcedurePermissions,CanDelete;4,ProjectPermissions,CanRead;4,ProjectPermissions,CanRegister;4,ContractPermissions,CanRead;4,ContractPermissions,CanWrite;4,ProjectPermissions,CanWithdraw;4,ContractPermissions,CanCheck;4,ContractCommunicationPermissions,CanRead;4,ContractCommunicationPermissions,CanWrite;4,ContractReportPermissions,CanRead;4,ContractReportPermissions,CanWrite;4,ContractReportPermissions,CanCheck;4,MonitoringFinancialControlPermissions,CanRead;4,MonitoringFinancialControlPermissions,CanWriteFinancial;4,MonitoringFinancialControlPermissions,CanWriteTechnical;4,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 5;
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl|5,OperationalMapPermissions,CanRead;5,OperationalMapPermissions,CanWrite;5,ProcedurePermissions,CanRead;5,ProcedurePermissions,CanWrite;5,ProcedurePermissions,CanCheck;5,ProcedurePermissions,CanDelete;5,ProjectPermissions,CanRead;5,ProjectPermissions,CanRegister;5,ContractPermissions,CanRead;5,ContractPermissions,CanWrite;5,ProjectPermissions,CanWithdraw;5,ContractPermissions,CanCheck;5,ContractCommunicationPermissions,CanRead;5,ContractCommunicationPermissions,CanWrite;5,ContractReportPermissions,CanRead;5,ContractReportPermissions,CanWrite;5,ContractReportPermissions,CanCheck;5,MonitoringFinancialControlPermissions,CanRead;5,MonitoringFinancialControlPermissions,CanWriteFinancial;5,MonitoringFinancialControlPermissions,CanWriteTechnical;5,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 6;
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl|6,OperationalMapPermissions,CanRead;6,OperationalMapPermissions,CanWrite;6,ProcedurePermissions,CanRead;6,ProcedurePermissions,CanWrite;6,ProcedurePermissions,CanCheck;6,ProcedurePermissions,CanDelete;6,ProjectPermissions,CanRead;6,ProjectPermissions,CanRegister;6,ContractPermissions,CanRead;6,ContractPermissions,CanWrite;6,ProjectPermissions,CanWithdraw;6,ContractPermissions,CanCheck;6,ContractCommunicationPermissions,CanRead;6,ContractCommunicationPermissions,CanWrite;6,ContractReportPermissions,CanRead;6,ContractReportPermissions,CanWrite;6,ContractReportPermissions,CanCheck;6,MonitoringFinancialControlPermissions,CanRead;6,MonitoringFinancialControlPermissions,CanWriteFinancial;6,MonitoringFinancialControlPermissions,CanWriteTechnical;6,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 7;
Update [dbo].[PermissionTemplates] SET [PermissionsString] = 'SapInterfacePermissions,CanImport;MonitoringPermissions,CanRead;NewsPermissions,CanPublish;GuidancePermissions,CanCreate;CompanyPermissions,CanRead;CompanyPermissions,CanWrite;UserAdminPermissions,CanAdministrate;UserAdminPermissions,CanControl|7,OperationalMapPermissions,CanRead;7,OperationalMapPermissions,CanWrite;7,ProcedurePermissions,CanRead;7,ProcedurePermissions,CanWrite;7,ProcedurePermissions,CanCheck;7,ProcedurePermissions,CanDelete;7,ProjectPermissions,CanRead;7,ProjectPermissions,CanRegister;7,ContractPermissions,CanRead;7,ContractPermissions,CanWrite;7,ProjectPermissions,CanWithdraw;7,ContractPermissions,CanCheck;7,ContractCommunicationPermissions,CanRead;7,ContractCommunicationPermissions,CanWrite;7,ContractReportPermissions,CanRead;7,ContractReportPermissions,CanWrite;7,ContractReportPermissions,CanCheck;7,MonitoringFinancialControlPermissions,CanRead;7,MonitoringFinancialControlPermissions,CanWriteFinancial;7,MonitoringFinancialControlPermissions,CanWriteTechnical;7,ProjectDossierPermissions,CanRead' WHERE [PermissionTemplateId] = 8;

DELETE FROM [dbo].[UserPermissions] Where [PermissionType] In ('Audit', 'AuditAuthorityCommunication', 'CertAuthorityCheck', 'CertAuthorityCommunication', 'EuReimbursedAmount', 'Irregularity', 'IrregularitySignal', 'SpotCheck', 'Certification');
GO

GO
CREATE TABLE [dbo].[IndicatorItemTypes] (
    [IndicatorItemTypeId]           INT                NOT NULL    IDENTITY,
    [Name]                          NVARCHAR(1000)     NOT NULL,
    [NameAlt]                       NVARCHAR(1000)     NOT NULL,

    [CreateDate]                    DATETIME2          NOT NULL,
    [ModifyDate]                    DATETIME2          NOT NULL,
    [Version]                       ROWVERSION         NOT NULL,

    CONSTRAINT [PK_IndicatorItemTypes]                 PRIMARY KEY ([IndicatorItemTypeId]),
)

GO
ALTER TABLE [Indicators]
ADD [IndicatorItemTypeId] INT NOT NULL,
CONSTRAINT [FK_Indicators_IndicatorItemTypes]            FOREIGN KEY ([IndicatorItemTypeId])          REFERENCES [dbo].[IndicatorItemTypes] ([IndicatorItemTypeId])
GO

GO
CREATE TABLE [dbo].[Directions] (
    [DirectionId]                   INT                NOT NULL    IDENTITY,
    [Name]                          NVARCHAR(1000)     NOT NULL,
    [NameAlt]                       NVARCHAR(1000)     NOT NULL,
    [Status]                        INT                NOT NULL,

    [CreateDate]                    DATETIME2          NOT NULL,
    [ModifyDate]                    DATETIME2          NOT NULL,
    [Version]                       ROWVERSION         NOT NULL,

    CONSTRAINT [PK_Directions]                         PRIMARY KEY ([DirectionId]),
    CONSTRAINT [CHK_Directions_Status]                 CHECK       ([Status] IN (1, 2))
)
GO
CREATE TABLE [dbo].[SubDirections] (
    [SubDirectionId]                INT                NOT NULL    IDENTITY,
    [DirectionId]                   INT                NOT NULL,
    [Name]                          NVARCHAR(1000)     NOT NULL,
    [NameAlt]                       NVARCHAR(1000)     NOT NULL,

    CONSTRAINT [PK_SubDirections]                      PRIMARY KEY ([SubDirectionId]),
    CONSTRAINT [FK_SubDirections_Directions]           FOREIGN KEY ([DirectionId])          REFERENCES [dbo].[Directions] ([DirectionId])
)
GO
CREATE TABLE [dbo].[ProgrammeDirections] (
    [ProgrammeDirectionId]  INT                NOT NULL      IDENTITY,
    [ProgrammeId]           INT                NOT NULL,
    [DirectionId]           INT                NOT NULL,
    [SubDirectionId]        INT                NULL,
    CONSTRAINT [PK_ProgrammeDirections]                      PRIMARY KEY ([ProgrammeDirectionId]),
    CONSTRAINT [FK_ProgrammeDirections_MapNodes]             FOREIGN KEY (ProgrammeId)            REFERENCES [dbo].[MapNodes] ([MapNodeId]),
    CONSTRAINT [FK_ProgrammeDirections_Directions]           FOREIGN KEY ([DirectionId])          REFERENCES [dbo].[Directions] ([DirectionId]),
    CONSTRAINT [FK_ProgrammeDirections_SubDirections]        FOREIGN KEY ([SubDirectionId])       REFERENCES [dbo].[SubDirections] ([SubDirectionId])
)
GO



